generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client_v2"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Item {
  id         String    @id @default(uuid())
  name       String
  type       String
  category   String
  specs      String
  locationId String?
  location   Location? @relation(fields: [locationId], references: [id])
  status     String    @default("Available")

  brand        String?
  model        String?
  color        String?
  serialNumber String?

  purchaseDate     DateTime?
  warrantyEnd      DateTime?
  purchaseLocation String?
  purchaseUrl      String?
  purchasePrice    Float? // Added field
  notes            String?
  image            String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lendingRecords LendingRecord[]
  history        ItemHistory[]
}

model ItemHistory {
  id        String   @id @default(uuid())
  itemId    String
  item      Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  action    String // CREATED, MOVED, LENT, RETURNED, UPDATED
  details   String? // e.g., "Moved to Bag 1", "Lent to John"
  timestamp DateTime @default(now())
}

model Location {
  id       String     @id @default(uuid())
  name     String
  type     String
  parentId String?
  parent   Location?  @relation("LocationHierarchy", fields: [parentId], references: [id])
  children Location[] @relation("LocationHierarchy")
  items    Item[]
}

model LendingRecord {
  id           String    @id @default(uuid())
  itemId       String
  item         Item      @relation(fields: [itemId], references: [id], onDelete: Cascade)
  borrowerName String
  borrowDate   DateTime  @default(now())
  dueDate      DateTime?
  returnDate   DateTime?
}

model Template {
  id        String   @id @default(uuid())
  name      String
  category  String
  config    String // JSON string of ItemFormData
  createdAt DateTime @default(now())
}

model Contact {
  id        String   @id @default(uuid())
  name      String   @unique
  phone     String?
  notes     String?
  createdAt DateTime @default(now())
}

model Brand {
  id   String @id @default(uuid())
  name String @unique
}

model User {
  id       String  @id @default(uuid())
  username String  @unique
  password String
  fullName String? // New field
  avatar   String? // New field
  theme    String  @default("default")
  colors   String?
}
